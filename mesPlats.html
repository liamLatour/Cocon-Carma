<!DOCTYPE html>
<html lang="fr">
<!--Déclaration des paramètre généraux de la page (les caractères utilisé, le titre, et autre)-->
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="menu.css">
    <link rel="stylesheet" href="tableau.css">
    <title>Cocon Carma</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<!--Ici commence le vrai code-->
<body>

    <div id="menu">
        <div id="menuContainer">
            <ul>
                <li><a href="index.html">Nouvelle commande</a></li>
                <li><a href="mesCommandes.html">Mes commandes</a></li>
                <li><a href="nouveauPlat.html">Nouveau plats</a></li>
            </ul>
        </div>
        <div id="hamClick"></div>
        <div id="hamburger">
            <div class="bar1"></div>
            <div class="bar2"></div>
            <div class="bar3"></div>
        </div>        
    </div>

    <h1>Mes Plats</h1>

    <table class="itemList" id="tManage">
        <tr>
            <th class="titre">Titre</th>
            <th class="prix">Prix</th>
            <th width="45"></th>
        </tr>
    </table>
    <div class="overflow noSelect">
        <table class="itemList" id="manage">
            <!--C'est ici qu'arrive les produits-->
        </table>  
    </div>


<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script>

    // vérifie que le naviguateur supporte cette fonctionalitée
    if (typeof(Storage) !== "undefined") {
        // Récupère et affiche les produits
        for (let i = 0; i < localStorage.length; i++){
            if(localStorage.key(i).includes("item")){
                let retrievedObject = JSON.parse(localStorage.getItem(localStorage.key(i)));
                let id = localStorage.key(i).replace("item", "");
                let name = retrievedObject.title;
                let price = retrievedObject.price;

                console.log(name);
                $("#manage").append('<tr class="item hover" data-item-id="'+ id +'"\
                                                data-item-name="'+ encodeURI(name) +'"\
                                                data-item-price="'+ price +'">\
                                    <td class="titre">'+ name +'</td>\
                                    <td class="prix">'+ price +'</td>\
                                    <td class="supr hover"></td>\
                                    </tr>');
            }
        }
    }

    $("#manage").on('click', 'td:not(.supr)', function(){
        window.location.href = "nouveauPlat.html?itemId=" + $(this).data("item-id");
    });

    $(".supr").on('click', function(){
        let destr = confirm("Voulez-vous suprimer ce plat ?");
        if(destr){
            localStorage.removeItem("item" + $(this).parent().data("item-id"));
            $(this).parent().remove();
        }
    });

    $("#hamClick").on('click', function(){
        document.getElementById("hamburger").classList.toggle("change");
        if($("#menuContainer").css("visibility") == "hidden"){
            $("#menuContainer").css('visibility', 'visible');
        }
        else{
            $("#menuContainer").css('visibility', 'hidden');
        }
    });
</script>
</body>
</html>