<!DOCTYPE html>
<html lang="fr">
<!--Déclaration des paramètre généraux de la page (les caractères utilisé, le titre, et autre)-->
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="style.css">
    <title>Cocon Carma</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<!--Ici commence le vrai code-->
<body>
    <h1>Nouvelle Commande</h1>

    <!--Partie gauche de l'écran qui affiche les différents plats-->
     <div class="split left">
        <div class="centered">
            <form action="/action_page.php">
                Cherchez un menu ou un plat:<br>
                <input type="text" name="searchText" value="Ex: panna cotta" onblur="if (this.value == '') {this.value = 'Ex: panna cotta';}"  onfocus="if (this.value == 'Ex: panna cotta') {this.value = '';}">
                <input type="submit" value="" id="search">
            </form>

            <table class="itemList" id="tFrom">
                <tr>
                    <th class="titre">Titre</th>
                    <th class="prix">Prix</th>
                </tr>
            </table>
            <div class="overflow">
                <table class="itemList" id="from">
                    <!--Pour tester-->
                    <tr class="item hover" data-item-id="0" data-item-name="Panna cotta" data-item-price="5">
                        <td class="titre">Panna cotta</td>
                        <td class="prix">5£</td>
                    </tr>
                    <tr class="item hover" data-item-id="1" data-item-name="Crème chocolat" data-item-price="9">
                        <td class="titre">Crème chocolat</td>
                        <td class="prix">5£</td>
                    </tr>
                </table>  
            </div>
        </div>
    </div>

    <!--Partie droite de l'écran qui affiche ce qu'il y a dans la commande actuel-->
    <div class="split right">
        <div class="centered">
            <h2>John Doe</h2>
            <table class="itemList" id="tTo">
                <tr>
                    <th class="titre">Titre</th>
                    <th class="quantite">Qantité</th>
                    <th class="prix">Prix</th>
                    <th width="45"></th>
                </tr>
            </table>
            <div class="overflow">
                <table class="itemList" id="to">
                    <!--it is here to write in-->
                </table>  
            </div>
        </div>
    </div>


<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script>
    // Function pour modifier nombre de produit
    function add(produit, nombre){
        if(produit.data("item-number")+nombre <= 0){
            produit.remove();
        }

        produit.data("item-number", produit.data("item-number")+nombre);
        produit.children(".quantite").html("<span class='moins hover'>-</span>"+produit.data("item-number")+"<span class='plus hover'>+</span>");
    }

    // Recupère les clicks sur les elements 'tr' qui ont un parent avec l'id 'from' 
    $("#from").on('click', 'tr', function(){
        // declare une variable locale(qui se détruit quand la function à fini) 'id' qui stocke l'identité du produit
        let id = $(this).data("item-id");
        // variable pour savoir si le produit doit être modifié ou ajouté
        let createNew = true;

        // Fonction qui vérifie si il éxiste déjà ce produit, si oui on en rajoute 1
        $("#to").children().children("tr").each(function (){
            if($(this).data("item-id") == id){
                add($(this), 1);
                createNew = false;
                return;
            }
        });

        // Si le produit n'est pas déjà dans la commande on l'ajoute (c'est juste du html que l'on ajoute dans le tableau 'to')
        if(createNew){
            $("#to").append("<tr class='item' data-item-id='"+ id +"'\
                                            data-item-name='"+ $(this).data("item-name") +"'\
                                            data-item-price='"+ $(this).data("item-price") +"'\
                                            data-item-number='1'>\
                                <td class='titre'>"+ $(this).data("item-name") +"</td>\
                                <td class='quantite'><span class='moins hover'>-</span>1<span class='plus hover'>+</span></td>\
                                <td class='prix'>"+ $(this).data("item-price") +"</td>\
                                <td class='supr hover'></td>\
                            </tr>");
        }
    });

    // Recupère les clicks sur les éléments fils de '#to' ayant la classe 'supr' (et de type 'td')
    $("#to").on('click', 'td.supr', function(){
        // Détruit le parent(le 'tr') de cette élément
        $(this).parent().remove();
    });

    // Gère les '+' et '-'
    $("#to").on('click', 'span', function(){
        let parent = $(this).parent().parent();

        if($(this).hasClass('moins')){
            add(parent, -1);
        }
        else if($(this).hasClass('plus')){
            add(parent, 1);
        }
    });
</script>
</body>
</html>